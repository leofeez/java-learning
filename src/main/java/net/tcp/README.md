# TCP

客户端和服务器端传输数据需要建立起一个TCP的连接，而TCP不存在连接的的概念，只存在请求和响应，
请求和响应都是基于数据包的形式。

在一个TCP连接上是可以发送多个http请求的，不同的版本这个模式不一样。

在HTTP/1.0中这个TCP连接是在http请求创建的时候同步创建的，http请求发送到服务器端，服务器端响应了之后，这个TCP连接就关闭了；

HTTP/1.1中可以以某种方式声明这个连接一直保持，一个请求传输完之后，另一个请求可以接着传输。这样的好处是：在创建一个TCP连接的过程中需要“三次握手”的消耗，“三次握手”代表有三次网络传输。

## TCP 报文的格式
```cpp
|——————————————————————————————————————————————————————————————————|
|        client ip:port          |      server ip:port             |
|__________________________________________________________________|
|                            sequence num                          |
|——————————————————————————————————————————————————————————————————|
|                            ack num                               |
|——————————————————————————————————————————————————————————————————|
|                            flags                                 |
|——————————————————————————————————————————————————————————————————|
```

1. 序号（sequence number）：Seq序号，占32位，用来标识从TCP源端向目的端发送的字节流，发起方发送数据时对此进行标记。
2. 确认号（acknowledgement number）：Ack序号，占32位，只有ACK标志位为1时，确认序号字段才有效，Ack=Seq+1。
3. 标志位（Flags）：共6个，即URG、ACK、PSH、RST、SYN、FIN等。具体含义如下：
   - URG：紧急指针（urgent pointer）有效。
   - ACK：确认序号有效。
   - PSH：接收方应该尽快将这个报文交给应用层。
   - RST：重置连接。
   - SYN：发起一个新连接。
   - FIN：释放一个连接。

**需要注意的是： 不要将确认序号Ack与标志位中的ACK搞混了。确认方Ack=发起方Seq+1，两端配对。**

## 三次握手

```text
客户端                                         服务器
          flags = SYN     | seqNum = x
          ——————————————————————————————————>
          flags = SYN,ACK | ackNum = x + 1, seqNum = y
         <——————————————————————————————————
          flags = ACK     | ackNum = y + 1
          ——————————————————————————————————>
```


## 四次挥手
